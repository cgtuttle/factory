SELECT a.eff_date, version, a.item_id, trait_id FROM item_specs AS a
WHERE eff_date = (SELECT MAX(ed.eff_date) FROM item_specs AS ed WHERE a.item_id = ed.item_id
		AND a.trait_id = ed.trait_id and ed.eff_date <= current_date)
AND version = (SELECT MAX(ev.version) FROM item_specs AS ev WHERE a.item_id = ev.item_id
		AND a.trait_id = ev.trait_id and ev.eff_date <= current_date)
ORDER BY a.item_id, a.trait_id